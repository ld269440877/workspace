# 数据分析方法论
第十二章
[Markdown 数学公式语法 - 简书](https://www.jianshu.com/p/4460692eece4)

[常用数学符号的 LaTeX 表示方法](https://www.mohu.org/info/symbols/symbols.htm)

## 概率论基础

[R和RStudio的下载及安装及RStudio打开后空白的解决](https://blog.csdn.net/qq_35164554/article/details/78942076?utm_source=app)

# 数组的集中趋势

## 常⽤的集中趋势指标-我们如何定义⼀个数组的中⼼
我们常⽤以下⼏个指标来描述⼀个数组的集中趋势：
==均值==-算数平均数，描述平均⽔平，例如：客单价、件单价⼈均访问时⻓、平均配送时⻓；
==中位数==-将数据按升序或降序排列后位于正中间的数，描述中等⽔平；
==众数==-数据中出现最多的数，描述⼀般⽔平；
假设A、B两组数：
```R{class= ' line-numbers'}
A：5，6，6，6，6，8，10
B：3，5，5，6，6，9，12
```
A组：
均值：6.74，中位数：6，众数：6；
B组：
均值：6.57，中位数：6，众数：5，6；
对A组做⼀些变化：
```RStudio{class= ' line-numbers'}
A：5，6，6，6，7，8，10，20
B：3，5，5，6，6，9，12
```
均值：8.375，中位数：6，众数：6
均值⼤幅度提升，但中位数和众数没有变化

|        | 优点                         | 缺点                                       |
| ------ | ---------------------------- | ------------------------------------------ |
| 均值   | 充分利⽤所有数据，适⽤性强     | 容易受到极端值影响                         |
| 中位数 | 能够避免被极端值过分影响     | 不敏感                                     |
| 众数   | 能够很好的反映数据的集中趋势 | 当数据没有明显的集中趋势时，基本没有信息量 |

均值在什么场景下需要注意：样本中有极⼤值或极⼩值，且极值在使⽤场景中不会复现，或难以复现的时候。
## EXCEL和R语⾔中的实现
> EXCEL：
均值：average(数组);
中位数：median(数组),quartile(数组，[quart]),0-最⼩值，1-下四分位数，2-中位数，3-上四分
位数，4-最⼤值；
众数：mode（数组）

> R：
均值：mean(数组)
中位数：median(数组)
众数：⽆内置函数

## 本节⼩结：
数组的集中趋势是数组最关键特征，简⽽⾔之，数组在哪个点集中，是数组最重要的属性；
均值是最常⽤的集中指标，但为了更客观的描述⼀个数组，需要辅助中位数和众数，才能更⽴体的
理解⼀个数组；
均值，中位数，众数都是⽇常数据处理中最常⽤的技能，⽆论什么⼯具，都需要熟练掌握；

## 课堂练习

- 课堂练习.xlxs 中，sheet-集中趋势⼀：样本数据为⼀家⾃助餐厅447位客户选择的⾃助餐价格，现在餐厅计划升级菜单，综合提升⽤户的⽤餐体验，餐厅应该优先优化哪⼀个价位；
> 题⽬主要强化均值、中位数、众数在EXCEL中的实现，并强化众数可以较快筛选出⼤⼦集的功能；

- 课堂练习.xlxs 中，sheet-集中趋势⼆：样本数据为某零售分销商旗下300款商品的⽉度销售额，现计划设定⼀个阈值，让阈值以下商品的分销商全部升级商品，应该选择什么阈值？
> 强化中位数突出数组排序，不受极⼤、极⼩值⼲扰的特性；

# 数组的离散程度

数组集中在哪⾥，说明了数组最主要的特征是什么；另⼀⽅⾯，数组的离散程度，则体现了这个特征的稳定程度；例如A地区冬季平均⽓温 0度，最低⽓温-10度，B地区平均⽓温-2度，最低⽓温-4度；说明虽然A地区整个冬季看上去⽐B地区更暖和，但受多种原因影响，⽓温的波动程度更⼤，当地居⺠可能更需要提防不稳定的⽓候。
⼀般我们⽤极差、⽅差、标准差三个概念来描述数组的离散程度：

## 极差-⼤减⼩
极差：最⼤值-最⼩值
```R{class= ' line-numbers'}
A:1，2，5，9，10
B:1，4，5，6，10
```
A组极差10-1=9，B组极差10-1=9，但很显然，A组的离散程度⼤于B组。

## ⽅差-每⼀个减均值

在统计描述中，⽅差⽤来计算每⼀个变量（观察值）与总体均数之间的差异。为避免出现离均差总和为零，离均差平⽅和受样本含量的影响，统计学采⽤平均离均差平⽅和来描述变量的离散程度。

总体⽅差的计算公式：

$$ \sigma^2=\frac{\sum_{i=1}^n(X_i-\mu)^2}{N}$$
$\sigma^2$为整体⽅差，$X_i$为变量， $\mu$为总体均值， N为总体列数。但在实际⼯作中，我们很难得到总体的均数，因此⼀般都⽤样本统计计量代替总体参数。
经过矫正，样本⽅差公式为：
$$S^2 = \frac{\sum_{i=1}^n (X_i-\overline{X})^2}{n-1}$$
$S^2$为样本⽅差， $X_i$为样本变量， $\overline{X}$为样本均值， n为样本量，可以看出和总体⽅差最⼤的区别是，样本⽅差除以n-1⽽⾮n，其中的原理是针对总体⽅差的⽆偏估计。

## 标准差-开个⽅
标准差的计算公式为：
$$S =\sqrt{ \frac{\sum_{i=1}^n (X_i-\overline{X})^2}{n-1}}$$
数列1，2，5，8，9，⽅差为10，已经超过了数列最⼤值的范畴，只看绝对值会造成该组数列⽅差很⼤的假象。其中本质的原因，是因为⽅差是样本个体与样本均值差的平⽅，平⽅的不只是数字的绝对值，还有单位。如果数列的单位是⽶，那么⽅差的单位就是平⽅⽶，如果数列的单位是单量，那么⽅差的单位就是单量平⽅。这样⽅差与原数组就失去了对⽐的意义，因此，引⼊标准差的概念，将⽅差的单位还原⾄与原数组⼀致，也使得数据组可对⽐。

⽅差或者标准差的业务价值：
1. 对⽐数组时考虑稳定性；
2. 识别数组需要做⼆次分类；

## EXCEL和R语⾔中的实现
EXCEL：
```R{class= ' line-numbers'}
极差：Max(数组)-Min(数组)
⽅差：Var(数组)
标准差：Stdev（数组）
```
```R{class= ' line-numbers'}
极差：Max(数组)-Min(数组)
⽅差：Var(数组)
标准差：Sd(数组)
```
## 本章⼩结
- 离散程度标志着数组的稳定性⾼低，两个数组对⽐的时候，综合⽐较均值和标准差/⽅差，能够更好的理解数据及背后的现象。
- 最常⽤的离散程度指标是标准差，在未来的数据⼯作、模型理解中都⾮常重要，定义，计算⽅法，实现⽅式都应熟练掌握。

# 频数分析

频数分析是指⽤⼀定的分类⽅式将数组分类，然后统计各分组下的样本数量，以图表辅助，⽤更直观的⽅式描述出数组的分布趋势的⼀种⽅法。
业务意义：
- ⼤问题变⼩问题，聚焦在需要关注的群体上；
- 找到合理的分类机制，⻓期分析数据；
⼀个班40个学⽣，考试成绩如下：
```R{class= ' line-numbers'}
73,87,88,65,73,76,80,95,83,69,55,67,70,94,86,81,87,95,84,92,92,76,69,97,72,90,
72,85,80,83,97,95,62,92,67,73,91,95,86,77
```
请试着描述⼀下这个班的成绩分布怎么样。
均值：81.3，中位数：83，众数：95
最⾼分：97，最低分：55，极差：42，⽅差：121.2，标准差：11
- 最⾼分为97分，且学⽣分数在⾼分段集中；
- 最低分距离均值相差81.3-55=26.3分，偏差较⼤，该同学需要重点关注
除了以上信息外，只依靠基础的数据指标，很难对⼀个数据集做出全⾯的解读，且拿到有限的信息都需
要较⼤的成本；

## 数据频度表-更直观的分布表
数据频度表是指按照某些维度，将数组分段后统计各组个数，的表格⼯具，能够更直观的反映出数组特
征，以下是将分数按照5分⼀档划分的数据频度表，可以很直观的发现，各分数段的学⽣⼈数都较为平
均，说明此次考试并没有让成绩好的学⽣拉开差距，试题较为简单；然⽽部分分数段的同学成绩较低，
需要额外关注；

| 分数学⽣ | ⼈数 |
| ------- | --- |
| 55-59   | 1   |
| 60-64   | 1   |
| 65-69   | 5   |
| 70-74   | 6   |
| 75-79   | 3   |
| 80-84   | 6   |
| 85-89   | 6   |
| 90-94   | 6   |
| 95-100  | 6   |

## 茎叶图-数据频度表的变种

R语⾔公式：
`stem(数组)`
![茎叶图](茎叶图-数据频度表的变种.png "茎叶图")

## 频度直⽅图-表达分布的柱形图

R语⾔公式：
`hist(数组)`
![频度直⽅图](频度直⽅图-表达分布的柱形图.png "频度直⽅图")

## 箱线图
R语⾔实现
`boxplot(数组)`
![箱线图](箱线图.png "箱线图")

## 本章⼩结

- 在建⽴了对数据的集中趋势，离散程度的认知后，本章更⽴体的介绍了如何全⾯的评估⼀个数组；
- 频数分析⽅法的⽬的是能够帮助⼤家找出数组中最有价值的信息，如何对数据分组需要不断的积累经验，不断提升对数据、业务的敏感度，不断找到更有效的分类维度。

## 课堂练习

- 课堂练习.xlxs 中，sheet-频度分析⼀：样本数据为某APP的⾸⻚迭代策略ab_test上线后，⽤户未来7⽇的活跃天数，为企业真实数据，请分析A、B组策略，哪组策略更优；
- 课堂练习.xlxs 中，sheet-频度分析⼆：样本数据为某APP的⾸⻚迭代策略ab_test上线后，⽤户未来30⽇的使⽤时⻓，为企业真实数据，请分析A、B组策略，哪组策略更优；
- 课堂练习.xlxs 中，sheet-频度分析三：样本数据为某零售电商业务，500位客户样本的⽉购买⾦额（⽉ARPU），请分析7、8两⽉⽤户购买⾏为的变化；

# 数据分布

## 变量的随机与连续性 -⼩数点后能数⼏位

**离散型随机变量**：数据可以⼀⼀列出，例如部⻔的员⼯数，⼀个⽉的天数；
**连续型随机变量**：数据不可以⼀⼀列出，例如⽤户使⽤APP的时⻓，⼈体的体温。
注意，当离散型变量的数据⾮常庞⼤时，就可以近似看做⼀个连续型随机变量。

## 伯努利分布（0-1分布）-抛⼀枚硬币
指⼀个有固定概率的，只有是或否两种情况的分布，例如当前降⾬概率为20%，问明天是否下⾬；某批
产品的残次品率为2%，随机抽取⼀个产品是否是残次品。
我们⼀般将事件成功（下⾬，收到残次品）记为1，不成功（不下⾬，抽到的商品不是残次品）记为0，
故这种分布也被称为0-1分布，分布律为：
$$
\left\{ 
\begin{array}{l}
P(X=1)=p \\ 
P(X=0)=1-p
\end{array}
\right.
$$
即$P(X=k)=p^k(1-p)^{(1-k)}, k=0, 1$

## ⼆项分布 -抛更多的硬币

我们将以上这样，有固定概率的，只会有两种可能性的实验称为伯努利实验，例如预测⼀下明天是否下
⾬，随机抽取⼀个产品检查是否残次。如果将⼀个伯努利实验重复n次，就构成了⼀个n重伯努利实验，
我们将实验结果构成的分布称为⼆项分布，记为：$P(X=k)=C_{n}^{k}p^k(1-p)^{(1-k)}, k=0, 1, 2.. n$,称X服从参数为n, p 的⼆项分布，也可记为 X~B(n,p) 。

很容易观察到，当n为1时，⼆项分布即为伯努利分布。
我们来看⼀个例⼦，⼀个⼯⼚有⼀批产品，次品率1%，分别从中抽取30个，300个，3,000个，30,000个，抽出样本中的次品个数分布是什么样的？
`rbinom(n, size, prob)`
我们模拟分别重复这个⽆放回的抽取实验10万次，得到如下的概率分布
- 30个：
![rbinom](rbinom重复无放回的抽取实验.png "rbinom")
- 300
![rbinom](rbinom重复无放回的抽取实验300.png "rbinom")
- 3000
![rbinom](rbinom重复无放回的抽取实验3000.png "rbinom")
- 30000
![rbinom](rbinom重复无放回的抽取实验30000.png "rbinom")

## 泊松分布 -你抛这么多我算不过来了
在计算机不发达的年代，⼆项分布的计算量庞⼤，负担较重，因此数学家推导出了⼆项分布的近似分
布，泊松分布；
我们先来看泊松分布的公式：

$$P(X=k)= \frac{\lambda^ke^{-\lambda}}{k!}$$
泊松公式的推导是由泊松定理⽽来：
$$\lim_{n\rightarrow\infty}(_k^n)p^k(1-p)^{(1-k)}=\frac{\lambda^ke^{-\lambda}}{k!}$$
泊松分布是⼀个⼆项式分布的近似，其中$\lambda$是⼀个常数，当p相当⼩，⼀般为0.1以下时，$\lambda=np$
`rpois(n, lambda)`
我们同样抽取10万个样本，次品率1%，套⼊到泊松分布的函数中区观察变化：
$\lambda=0.3$
![泊松分布03](泊松分布03.png "泊松分布03")
$\lambda=3$
![泊松分布3](泊松分布3.png "泊松分布3")
$\lambda=30$
![泊松分布30](泊松分布30.png "泊松分布30")
$\lambda=300$
![泊松分布300](泊松分布300.png "泊松分布300")
对照⼆项式分布的图形，发现$\lambda=np$被这些分布图形证明了

## 分布函数 -⽤函数描述⼀个分布律
对于连续型随机变量，我们不可能像离散型随机变量⼀样，去列出每个值的分布律，因此当我们需要描
述⼀个连续型随机变量的分布情况时，就需要引⼊新的⽅式：分布函数（累计分布函数）；
设X是⼀个随机变量实数，$F(x)=P\{X \leq x\}$称为的分布函数，也可以记为X~F(x);
对于任意$x_1, X_2(x_1 \leq X_2)$有：
$$P\{x < X \leq x_2\} = P\{X \leq x_2\}-P\{X \leq x_1\} = F(x_2)-F(x_1)$$
$$P\{X>x_1\}=1-P\{X \leq x_1\}=1-F(x_1), (x_1<x_2)$$

因此，若已知 X 的分布函数，就可以知道 X 落在任意区间的概率统计规律，如果将 X 看成是数轴上的随机坐标，那么，分布函数 F(x)在 x 处的函数值就表示 x 落在区间$(-\infty,x)$中的概率。
分布函数有哪些性质呢：
- F(x)是一个不减函数
- $$0 \leq F(x) \leq 1, 且F(-\infty)= \lim_{x \rightarrow -\infty}F(x) =0$$
- $$F(\infty)=\lim_{x \rightarrow \infty}F(x)=1$$
- F(x)是右连续的

## 概率密度函数-来求个导
概率密度函数就是连续型随机变量的「分布律⽅程」；
对于任意随机变量X的分布F(x)存在⾮负可积函数f(x)，使对于任意x有：
$$F(x)=\int_{-\infty}^{x}f(t)dt$$
则称X为连续型随机变量，f(x)称为X的概率密度函数。
- $f(x)\geq 0$
- $$\int_{-\infty}^{\infty}f(x)dx=F(\infty)=1$$
- 对于任意实数x_1, x_2, $(x_1 \leq x_2)$,有$$P{x_1<X \leq x_2} = F(x_2)-F(x_1)= \int_{x_1}^{x_2}f(x)dx$$
- 若f(x)在点x处连续，则有$F'(x)=f(x)$

## 均匀分布-⽤最简单的打个样
若连续函数的概率密度函数为：
$$
\left\{ 
\begin{array}{l}
\frac{1}{x_2-x_1} , x_1 < x \leq x_2\\ 
0, 其他
\end{array}
\right.
$$
则称为均匀分布。
均匀分布的概率密度函数及累计分布函数如下：
![概率密度函数及累计分布函数](均匀分布的概率密度函数及累计分布函数.png "概率密度函数及累计分布函数")
我们很容易发现，概率密度函数指的是数组分布再各点的概率，⽽分布函数（累积分布函数）则是数组
概率逐渐累积⾄1的过程，概率密度函数是分布函数的导数。

## 正太分布-⽆限切分的⼆项式分布
正太分布的定义：
若连续型随机变量X的概率密度为$$f(x)=\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(x-\mu)^2}{2\sigma^2}}, -\infty < x < \infty$$
，则称X服从参数为$\mu, \sigma^2$的正太分布，记作$X~N(\mu, \sigma^2)$。

正太分布具有如下特征：
- 曲线关于$x=\mu$对称；
- 当$x=\mu$ 时概率密度函数可以取得最⼤值$f(x)=\frac{1}{\sqrt{2\pi}\sigma}$
- 在具有同样⻓度的区间中，当区间离$\mu$越远，X落在这个区间的概率越⼩；
对⽐⼀下不同的$\mu,\sigma$下的正太分布的概率密度的函数：

![正太分布sigma](正太分布sigma.png "正太分布sigma")
当$\mu=0,\sigma^2=1$时，即为⼀种最特殊，也⾮常重要的正态分布——标准正太分布，概率密度函数和分布函数分别⽤$\varphi(x), \phi(x)$ 表示，$$\varphi(x)=\frac{1}{\sqrt{2\pi}}e^{\frac{-x^2}{2}}$$
- 在标准正太分布中，随机变量X落在（-1,1），即⼀倍标准差的概率是68.3%，（-2,2），即两倍标准差是95.5%，（-3,3）三倍标准差的概率是99.7%；
- $\varphi(-x) = 1-\phi(x)$
- 对于所有⼀般的正太分布，可以通过重构为$Z=\frac{X-\mu}{\sigma}$转化为标准正太分布，重构过的Z满⾜N(0,1)
标准正太分布会在以后的模型学习中扮演⾮常重要的⻆⾊，请同学们⼀定要强化记忆。

## 本章⼩结
- 学习数组分布的⽬的是帮助⼤家构建起概率思维的基本框架，我们⽇常⻅到的订单量，⽤户使⽤时⻓等等，都是基于⼀定概率分布假设下，诸多可能性当中的⼀种。这种思维也是⽇后进⾏数据分析、预测的重要思维基础。
- ⽆论是离散型变量还是连续型变量，底层逻辑原理都是⽆数次伯努利实验堆积的结果，这使得我们⽇常的很多现象，都可以归⼊到已有的分布模型中，去探索数组背后的本质。
- 正太分布作为最为重要的⼀个分布模型，需要熟练掌握其性质及参数。

## 总结

- 今天的内容较为抽象，但是学好以后课程的基础，请同学们多结合⽇常的⼯作实际思考，多把⽇常
的⼯作问题抽象称为统计问题，强化⾃⼰的思维训练；
- 描述⼀个数组往往会从集中趋势⼊⼿，我们⽇常最常⽤的指标即为均值，同时中位数、众数也是不
可忽视的辅助指标；
- 是否能够解读出数据的离散程度中包含的信息，往往直接决定了我们能够成功理解数组背后的信
息，常⽤的指标有⽅差与标准差，其中标准差最为常⽤；
- 数组的频度分析⽬的是更全⾯、直观的反映数组信息，常⽤的⽅法有直⽅图，箱线图，实现⽅法需
要掌握；
- 数组的分布模型是从底层理解数组构成思维框架，重要的是熟悉、并掌握从伯努利实验推倒致正态
分布的逻辑过程，这将直接影响在未来的模型学习中，能否理解到位的关键。



